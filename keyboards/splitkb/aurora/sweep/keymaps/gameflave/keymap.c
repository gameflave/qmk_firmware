#pragma once
#include "gameflave.h"

#include "keycodes.h"
#include "layers/base.h"
#include "layers/functions.h"
#include "layers/modifiers.h"
#include "layers/symbols.h"
#include "layers/numbers.h"
#include "layers/navigation.h"
#include "layers/game.h"
#include "layers/japanese.h"

const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [BASE] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_AACU   ,      US_J     ,      US_O     ,     US_EACU   ,LT(GAME_1,US_B),         LT(JP_1,US_F) ,     US_D      ,      US_L     ,      US_ACUT  ,     US_X      ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_A      ,      US_I     ,      US_E     ,     US_U      ,     US_COMM   ,              US_P     ,     US_T      ,      US_S     ,      US_R     ,     US_N      ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_Z      ,      US_Y     ,      US_Q     ,     US_W      ,     US_K      ,              US_G     ,   LT(0,US_C)  ,      US_M     ,      US_H     ,     US_V      ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                KC_SPC         ,         MO(SYM)         ,            MO(NUM)        ,        KC_LSFT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [SYM] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
        LT(0,US_ACUT) ,    US_PERC    ,    US_QUES    ,    US_EXLM    ,    US_AT      ,            US_SLSH    ,    US_LCBR    ,    US_RCBR    ,    US_BSLS    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           US_DIAE    , LT(0,US_DGRV) ,    SY_EGRV    ,    US_DLR     , LT(0,US_DCIR) ,            US_LABK    ,    US_LPRN    ,    US_RPRN    ,    US_RABK    ,    US_EQL     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
        LT(1,US_DTIL) ,    US_SCLN    ,    US_COLN    ,    US_UNDS    ,    US_DEG     ,            US_HASH    ,    US_LBRC    ,    US_RBRC    ,    US_AMPR    ,    US_PIPE    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         _______         ,           _______         ,         _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [NUM] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_ESC     ,    XXXXXXX    ,    KC_BSPC    ,    KC_DEL     ,    XXXXXXX    ,             OSL(FN)   ,     US_7      ,     US_8      ,     US_9      ,    US_ASTR    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_TAB     ,    KC_LALT    ,    KC_LCTL    ,    KC_LSFT    ,    KC_LGUI    ,             US_0      ,     US_4      ,     US_5      ,     US_6      ,    US_PLUS    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,             US_MINS   ,     US_1      ,     US_2      ,     US_3      ,    US_DOT     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,          _______        ,           _______         ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [FN] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_ESC     ,    XXXXXXX    ,    KC_BSPC    ,    KC_DEL     ,    XXXXXXX    ,            KC_F12     ,     KC_F7     ,     KC_F8     ,     KC_F9     ,    KC_PSCR    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_TAB     ,    KC_LALT    ,    KC_LCTL    ,    KC_LSFT    ,    KC_LGUI    ,            KC_F10     ,     KC_F4     ,     KC_F5     ,     KC_F6     ,    KC_INS     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,            KC_F11     ,     KC_F1     ,     KC_F2     ,     KC_F3     ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                XXXXXXX        ,         XXXXXXX         ,            XXXXXXX        ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [NAV_L] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    KC_END     ,    XXXXXXX    ,    KC_HOME    ,    KC_PGUP    ,            XXXXXXX    ,    KC_DEL     ,    KC_BSPC    ,    XXXXXXX    ,    KC_ESC     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_LEFT    ,    KC_UP      ,    KC_DOWN    ,    KC_RIGHT   ,    KC_PGDN    ,            KC_RGUI    ,    KC_RSFT    ,    KC_LCTL    ,    KC_LALT    ,    KC_TAB     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         TG(NAV_L)       ,           XXXXXXX         ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [NAV_R] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_ESC     ,    XXXXXXX    ,    KC_BSPC    ,    KC_DEL     ,    XXXXXXX    ,            KC_PGUP    ,    KC_HOME    ,    XXXXXXX    ,    KC_END     ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_TAB     ,    KC_LALT    ,    KC_LCTL    ,    KC_LSFT    ,    KC_LGUI    ,            KC_PGDN    ,    KC_LEFT    ,    KC_DOWN    ,    KC_UP      ,    KC_RIGHT   ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         XXXXXXX         ,           TG(NAV_R)       ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [MOD_L] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_ESC     ,    _______    ,    KC_BSPC    ,    KC_DEL     ,    _______    ,            _______    ,    _______    ,    _______    ,    _______    ,    _______    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_TAB     ,    KC_LALT    ,    KC_LCTL    ,    KC_LSFT    ,    KC_LGUI    ,            _______    ,    _______    ,    _______    ,    _______    ,    _______    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           _______    ,    _______    ,    _______    ,    _______    ,    _______    ,            _______    ,    _______    ,    _______    ,    _______    ,    _______    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         TG(MOD_L)       ,           _______         ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [MOD_R] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           _______    ,    _______    ,    _______    ,    _______    ,    _______    ,            _______    ,    KC_DEL     ,    KC_BSPC    ,    _______    ,    KC_ESC     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           _______    ,    _______    ,    _______    ,    _______    ,    _______    ,            KC_RGUI    ,    KC_RSFT    ,    KC_LCTL    ,    KC_LALT    ,    KC_TAB     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           _______    ,    _______    ,    _______    ,    _______    ,    _______    ,            _______    ,    _______    ,    _______    ,    _______    ,    _______    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         _______       ,             TG(MOD_R)       ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
       /*
    [NUM] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_MUTE    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    KC_VOLU    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    KC_MPRV    ,    KC_MNXT    ,    KC_VOLD    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                XXXXXXX        ,        KC_MPLY          ,            XXXXXXX        ,         XXXXXXX
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [MOUSE] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    KC_WH_L    ,    XXXXXXX    ,    KC_WH_R    ,    TG(MOUSE)  ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_WH_U    ,    KC_BTN4    ,    KC_MS_U    ,    KC_BTN5    ,    XXXXXXX    ,            XXXXXXX    ,    KC_RSFT    ,    KC_LCTL    ,    KC_LALT    ,    KC_LGUI    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_WH_D    ,    KC_MS_L    ,    KC_MS_D    ,    KC_MS_R    ,    XXXXXXX    ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                KC_BTN3        ,        KC_BTN1          ,            KC_BTN2        ,         XXXXXXX
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),*/
    [GAME_1] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_ESC     ,     US_1      ,      US_2     ,      US_3     ,     US_4      ,              US_5     ,      US_6     ,      US_7     ,      US_8     ,      US_9     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_TAB     ,     US_Q      ,      US_W     ,      US_E     ,     US_R      ,              US_T     ,      US_Y     ,      US_U     ,      US_I     ,      US_O     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           KC_LSFT    ,     US_A      ,      US_S     ,      US_D     ,     US_F      ,              US_G     ,      US_H     ,      US_J     ,      US_K     ,      US_L     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                              MO(GAME_2)       ,          KC_SPC         ,          TG(GAME_1)       ,         _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [GAME_2] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_Z      ,      US_X     ,      US_C     ,      US_V     ,     US_B      ,            US_COMM    ,     KC_P7     ,     KC_P8     ,     KC_P9     ,    US_SLSH    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_N      ,      US_M     ,    _______    ,    US_LBRC    ,    US_RBRC    ,            KC_P0      ,     KC_P4     ,     KC_P5     ,     KC_P6     ,    US_EQL     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            US_P      ,    _______    ,    _______    ,    _______    ,    US_COLN    ,            US_DOT     ,     KC_P1     ,     KC_P2     ,     KC_P3     ,    US_MINS    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,          _______        ,            _______        ,         _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [JP_1] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_RA     ,     JP_RU     ,     JP_KO     ,     JP_HA     ,     JP_YO     ,             JP_KI     ,     JP_NO     ,     JP_KU     ,     JP_A      ,     JP_RE     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_TA     ,     JP_TO     ,     JP_KA     ,     JP_TE     ,     JP_MO     ,             JP_WO     ,     JP_I      ,     JP_U      ,     JP_SI     ,     JP_N      ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_MA     ,     JP_RI     ,     JP_NI     ,     JP_SA     ,     JP_NA     ,             JP_SU     ,     JP_TU     ,     KC_TAB    ,     XXXXXXX   ,     JP_S_TU   ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                KC_SPC         ,         MO(JP_2)        ,            MO(JP_3)       ,         KC_ENT
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [JP_2] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_HI     ,     JP_SO     ,     KC_BSPC   ,     JP_S_YA   ,     JP_HO     ,             JP_GI     ,     JP_GE     ,     JP_GU     ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_NU     ,     JP_NE     ,     JP_S_YU   ,     JP_S_YO   ,     JP_HU     ,            XXXXXXX    ,     JP_DI     ,     JP_VU     ,     JP_ZI     ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_S_E    ,     JP_S_O    ,     JP_SE     ,     JP_YU     ,     JP_HE     ,             JP_ZU     ,     JP_DU     ,    TG(JP_1)   ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         _______         ,           MO(JP_4)         ,        _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),
    [JP_3] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_BI     ,     JP_ZO     ,     JP_GO     ,     JP_BA     ,     JP_BO     ,             JP_E      ,     JP_KE     ,     JP_ME     ,     JP_MU     ,     JP_RO     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_DA     ,     JP_DO     ,     JP_GA     ,     JP_DE     ,     JP_BU     ,             JP_O      ,     JP_TI     ,     KC_PMNS   ,     JP_MI     ,     JP_YA     ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_S_KA   ,     JP_S_KE   ,     JP_ZE     ,     JP_ZA     ,     JP_BE     ,             JP_WA     ,     JP_S_I    ,     JP_S_A    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                 _______       ,         MO(JP_4)        ,           _______         ,       _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    ),

    [JP_4] = LAYOUT(
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
            JP_PI     ,    XXXXXXX    ,    XXXXXXX    ,     JP_PA     ,     JP_PO     ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,     S(KC_SPC) ,     JP_PU     ,            XXXXXXX    ,    JP_MHEN    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
           XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,     XXXXXXX   ,     JP_PE     ,            XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,    XXXXXXX    ,
    //|---------------+---------------+---------------+---------------+---------------|       |---------------+---------------+---------------+---------------+---------------|
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
                                                _______        ,         _______         ,           _______         ,         _______
    //                               |-------------------------+-------------------------| |-------------------------+-------------------------|
    )
};


bool process_record_user(uint16_t keycode, keyrecord_t* record) {
    if (!record->event.pressed && should_clear_oneshot_layer) {
        clear_oneshot_layer_state(ONESHOT_PRESSED);
        should_clear_oneshot_layer = false;
    }

    if (!process_record_user_base(keycode, record))
        return false;
    if (!process_record_user_sym(keycode, record))
        return false;
    if (!process_record_user_num(keycode, record))
        return false;
    if (!process_record_user_nav(keycode, record))
        return false;
    if (!process_record_user_game(keycode, record))
        return false;
    if (!process_record_user_jp(keycode, record))
        return false;

    return true;
}

const key_override_t **key_overrides = (const key_override_t *[]){
    KEY_OVERRIDES_BASE
    NULL
};

combo_t key_combos[] = {
    KEY_COMBOS_BASE
};

uint8_t underglow_base_hue = 0;
uint32_t underglow_animation_callback(uint32_t trigger_time, void* cb_arg) {
    LCh underglow_base_lch = {0.75f, 0.35f, underglow_base_hue};
    RGB underglow_base_rgb = oklch_to_srgb(&underglow_base_lch);
    underglow_base_hue = (underglow_base_hue + 1) % 361;

    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 0 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 1 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 2 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 3 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 4 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 5 );
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 28);
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 27);
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 26);
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 25);
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 24);
    rgblight_setrgb_at(underglow_base_rgb.r, underglow_base_rgb.g, underglow_base_rgb.b, 23);

    return 50;
}

void keyboard_post_init_user(void) {
    // Initialize RGB to static black
    rgblight_enable_noeeprom();
    rgblight_sethsv_noeeprom(HSV_BLACK);
    rgblight_mode_noeeprom(RGBLIGHT_MODE_STATIC_LIGHT);

    defer_exec(500, underglow_animation_callback, NULL);
}

void housekeeping_task_user(void) {
    switch (get_highest_layer(layer_state)) {
        case JP_4:
            set_rgblight_jp(4);
            break;
        case JP_3:
            set_rgblight_jp(3);
            break;
        case JP_2:
            set_rgblight_jp(2);
            break;
        case JP_1:
            set_rgblight_jp(1);
            break;
        case GAME_2:
            set_rgblight_game(2);
            break;
        case GAME_1:
            set_rgblight_game(1);
            break;
        case FN:
            set_rgblight_fn();
            break;
        case NAV_L:
            set_rgblight_nav(LEFT);
        case MOD_R:
            set_rgblight_mod(RIGHT);
            break;
        case NAV_R:
            set_rgblight_nav(RIGHT);
        case MOD_L:
            set_rgblight_mod(LEFT);
            break;
        case NUM:
            set_rgblight_num();
            break;
        case SYM:
            set_rgblight_sym();
            break;
        case BASE:
        default:
            set_rgblight_base();
            break;
    }
}
